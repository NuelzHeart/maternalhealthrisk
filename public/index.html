<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maternal Health Risk Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-pink-50 to-purple-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-purple-800 mb-2">ü§± Maternal Health Risk Checker</h1>
            <p class="text-gray-600">Advanced AI-powered health assessment for expectant mothers</p>
        </div>

        <div id="successAlert" class="hidden mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
            <span id="successMessage"></span>
        </div>

        <div id="errorAlert" class="hidden mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
            <span id="errorMessage"></span>
        </div>

        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Patient Information & Vital Signs</h2>

                <form id="healthForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Patient Name</label>
                            <input type="text" id="patientName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                            <input type="number" id="age" min="15" max="50" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Systolic Blood Pressure (mmHg)</label>
                            <input type="number" id="systolic" min="70" max="200" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Diastolic Blood Pressure (mmHg)</label>
                            <input type="number" id="diastolic" min="40" max="120" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Blood Sugar (mg/dL)</label>
                            <input type="number" id="bloodSugar" min="50" max="400" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Body Temperature (¬∞C)</label>
                            <input type="number" id="temperature" min="35" max="42" step="0.1" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Was this a fasting blood sugar test?</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="fasting" value="true" required class="text-purple-600 focus:ring-purple-500">
                                <span class="ml-2">Yes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="fasting" value="false" required class="text-purple-600 focus:ring-purple-500">
                                <span class="ml-2">No</span>
                            </label>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="w-full bg-purple-600 text-white py-3 px-6 rounded-lg hover:bg-purple-700 transition duration-200 font-semibold">
                        üîç Assess Health Risk
                    </button>
                </form>
            </div>

            <div id="resultsSection" class="hidden bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Risk Assessment Results</h2>
                <div id="resultsContent"></div>
            </div>

            <div id="recommendationsSection" class="hidden bg-white rounded-xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">ü§ñ AI Health Recommendations</h2>
                <div id="recommendationsContent"></div>
            </div>

            <div class="text-center mt-8">
                <a href="/admin" hidden class="text-purple-600 hover:text-purple-800 text-sm">
                    <!-- üîê Admin Panel -->
                </a>
            </div>
        </div>
    </div>

    <script>
        // Assessment functions (same as before)
        function assessBP(systolic, diastolic) {
            if (90 <= systolic && systolic <= 119 && 60 <= diastolic && diastolic <= 79) {
                return { risk: "Low Risk", score: 0 };
            } else if ((120 <= systolic && systolic <= 139) || (80 <= diastolic && diastolic <= 89)) {
                return { risk: "Mid Risk", score: 1 };
            } else {
                return { risk: "High Risk", score: 2 };
            }
        }

        function assessBloodSugar(sugar, isFasting) {
            if (isFasting) {
                if (70 <= sugar && sugar <= 99) {
                    return { risk: "Low Risk", score: 0 };
                } else if (100 <= sugar && sugar <= 125) {
                    return { risk: "Mid Risk", score: 1 };
                } else {
                    return { risk: "High Risk", score: 2 };
                }
            } else {
                if (sugar < 140) {
                    return { risk: "Low Risk", score: 0 };
                } else if (140 <= sugar && sugar <= 199) {
                    return { risk: "Mid Risk", score: 1 };
                } else {
                    return { risk: "High Risk", score: 2 };
                }
            }
        }

        function assessTemperature(tempC) {
            if (36.1 <= tempC && tempC <= 37.2) {
                return { risk: "Low Risk", score: 0 };
            } else if (37.3 <= tempC && tempC <= 38.0) {
                return { risk: "Mid Risk", score: 1 };
            } else {
                return { risk: "High Risk", score: 2 };
            }
        }

        function overallRiskLevel(totalScore) {
            if (totalScore <= 1) {
                return "‚úÖ Low Risk";
            } else if (totalScore <= 3) {
                return "‚ö†Ô∏è Mid Risk";
            } else {
                return "‚ùóHigh Risk (Medical Alert)";
            }
        }

        // AI Recommendation System
        function generateRecommendations(bpRisk, sugarRisk, tempRisk, totalScore, patientData) {
            let recommendations = [];

            // Blood Pressure Recommendations
            if (bpRisk.score === 0) {
                recommendations.push({
                    category: "Blood Pressure",
                    icon: "üíö",
                    text: "Excellent blood pressure! Continue your current healthy lifestyle. Regular monitoring during pregnancy is still important."
                });
            } else if (bpRisk.score === 1) {
                recommendations.push({
                    category: "Blood Pressure",
                    icon: "‚ö†Ô∏è",
                    text: "Mild elevation detected. Consider reducing sodium intake, gentle exercise (as approved by your doctor), and stress management techniques. Monitor twice weekly."
                });
            } else {
                recommendations.push({
                    category: "Blood Pressure",
                    icon: "üö®",
                    text: "HIGH PRIORITY: Consult your healthcare provider immediately. This may indicate preeclampsia or hypertension requiring urgent medical attention."
                });
            }

            // Blood Sugar Recommendations
            if (sugarRisk.score === 0) {
                recommendations.push({
                    category: "Blood Sugar",
                    icon: "üíö",
                    text: "Blood sugar levels are optimal. Maintain balanced nutrition with complex carbohydrates and regular meal timing."
                });
            } else if (sugarRisk.score === 1) {
                recommendations.push({
                    category: "Blood Sugar",
                    icon: "‚ö†Ô∏è",
                    text: "Borderline glucose levels. Consider gestational diabetes screening. Focus on low-glycemic foods, smaller frequent meals, and light physical activity."
                });
            } else {
                recommendations.push({
                    category: "Blood Sugar",
                    icon: "üö®",
                    text: "URGENT: High glucose levels require immediate medical evaluation. This may indicate gestational diabetes requiring professional management."
                });
            }

            // Temperature Recommendations
            if (tempRisk.score === 0) {
                recommendations.push({
                    category: "Temperature",
                    icon: "üíö",
                    text: "Normal body temperature. Continue maintaining good hygiene and avoid exposure to infections."
                });
            } else if (tempRisk.score === 1) {
                recommendations.push({
                    category: "Temperature",
                    icon: "‚ö†Ô∏è",
                    text: "Mild fever detected. Rest, stay hydrated, and monitor temperature. Consult your doctor if it persists or increases."
                });
            } else {
                recommendations.push({
                    category: "Temperature",
                    icon: "üö®",
                    text: "HIGH FEVER: Seek immediate medical attention. High fever during pregnancy can be dangerous for both mother and baby."
                });
            }

            // Overall Recommendations
            if (totalScore <= 1) {
                recommendations.push({
                    category: "Overall Health",
                    icon: "üåü",
                    text: "Excellent overall health status! Continue regular prenatal check-ups, maintain healthy diet, stay active as recommended by your doctor, and get adequate rest."
                });
            } else if (totalScore <= 3) {
                recommendations.push({
                    category: "Overall Health",
                    icon: "üìã",
                    text: "Some areas need attention. Schedule a check-up with your healthcare provider within the next few days. Follow the specific recommendations above."
                });
            } else {
                recommendations.push({
                    category: "Overall Health",
                    icon: "üö®",
                    text: "CRITICAL: Multiple high-risk factors detected. Contact your healthcare provider or go to the emergency room immediately. Do not delay medical care."
                });
            }

            return recommendations;
        }

        // API Functions (These assume you have a backend server running at these endpoints)
        async function saveAssessment(assessmentData) {
  try {
    const response = await fetch('/api/assessments', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(assessmentData)
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || 'Failed to save assessment');
    }
    
    return await response.json();
  } catch (error) {
    console.error('Error saving assessment:', error);
    throw error;
  }
}

        // Alert Functions
        function showAlert(type, message) {
            const alertElement = document.getElementById(`${type}Alert`);
            const messageElement = document.getElementById(`${type}Message`);

            messageElement.textContent = message;
            alertElement.classList.remove('hidden');

            // Hide alert after 5 seconds
            setTimeout(() => {
                alertElement.classList.add('hidden');
            }, 5000);
        }

        // Form Submission
        document.getElementById('healthForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ Processing...';

            try {
                // Get form data
                const patientName = document.getElementById('patientName').value;
                const age = parseInt(document.getElementById('age').value);
                const systolic = parseInt(document.getElementById('systolic').value);
                const diastolic = parseInt(document.getElementById('diastolic').value);
                const bloodSugar = parseInt(document.getElementById('bloodSugar').value);
                const temperature = parseFloat(document.getElementById('temperature').value);
                const isFasting = document.querySelector('input[name="fasting"]:checked').value === 'true';

                // Perform assessments
                const bpRisk = assessBP(systolic, diastolic);
                const sugarRisk = assessBloodSugar(bloodSugar, isFasting);
                const tempRisk = assessTemperature(temperature);
                const totalScore = bpRisk.score + sugarRisk.score + tempRisk.score;
                const overallRisk = overallRiskLevel(totalScore);

                // Create patient data object
                const patientData = {
                    patientName, age, systolic, diastolic, bloodSugar, temperature, isFasting,
                    bpRisk, sugarRisk, tempRisk, totalScore, overallRisk
                };

                // Save to backend (simulated)
                await saveAssessment(patientData);

                showAlert('success', 'Assessment completed and saved successfully!');

                // Display results
                displayResults(patientData);

                // Generate and display AI recommendations
                const recommendations = generateRecommendations(bpRisk, sugarRisk, tempRisk, totalScore, patientData);
                displayRecommendations(recommendations);

                // Clear the form after successful submission
                this.reset();
                document.getElementById('resultsSection').classList.remove('hidden');
                document.getElementById('recommendationsSection').classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'Failed to save assessment. Please try again.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'üîç Assess Health Risk';
            }
        });

        function displayResults(data) {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-2">Patient Information</h3>
                        <p><strong>Name:</strong> ${data.patientName}</p>
                        <p><strong>Age:</strong> ${data.age} years</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-2">Assessment Date</h3>
                        <p>${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="p-4 rounded-lg ${data.bpRisk.score === 0 ? 'bg-green-100' : data.bpRisk.score === 1 ? 'bg-yellow-100' : 'bg-red-100'}">
                        <h4 class="font-semibold mb-2">ü©∫ Blood Pressure</h4>
                        <p class="text-sm">${data.systolic}/${data.diastolic} mmHg</p>
                        <p class="font-medium">${data.bpRisk.risk}</p>
                    </div>
                    <div class="p-4 rounded-lg ${data.sugarRisk.score === 0 ? 'bg-green-100' : data.sugarRisk.score === 1 ? 'bg-yellow-100' : 'bg-red-100'}">
                        <h4 class="font-semibold mb-2">üçØ Blood Sugar</h4>
                        <p class="text-sm">${data.bloodSugar} mg/dL ${data.isFasting ? '(Fasting)' : '(Non-fasting)'}</p>
                        <p class="font-medium">${data.sugarRisk.risk}</p>
                    </div>
                    <div class="p-4 rounded-lg ${data.tempRisk.score === 0 ? 'bg-green-100' : data.tempRisk.score === 1 ? 'bg-yellow-100' : 'bg-red-100'}">
                        <h4 class="font-semibold mb-2">üå°Ô∏è Temperature</h4>
                        <p class="text-sm">${data.temperature}¬∞C</p>
                        <p class="font-medium">${data.tempRisk.risk}</p>
                    </div>
                </div>

                <div class="text-center p-6 rounded-lg ${data.totalScore <= 1 ? 'bg-green-100' : data.totalScore <= 3 ? 'bg-yellow-100' : 'bg-red-100'}">
                    <h3 class="text-2xl font-bold mb-2">Overall Risk Assessment</h3>
                    <p class="text-3xl font-bold">${data.overallRisk}</p>
                    <p class="text-sm mt-2">Risk Score: ${data.totalScore}/6</p>
                </div>
            `;

            document.getElementById('resultsSection').classList.remove('hidden');
        }

        function displayRecommendations(recommendations) {
            const recommendationsContent = document.getElementById('recommendationsContent');
            recommendationsContent.innerHTML = recommendations.map(rec => `
                <div class="mb-4 p-4 bg-gray-50 rounded-lg border-l-4 ${
                    rec.icon === 'üíö' ? 'border-green-500' :
                    rec.icon === '‚ö†Ô∏è' ? 'border-yellow-500' :
                    'border-red-500'
                }">
                    <h4 class="font-semibold text-gray-800 mb-2">${rec.icon} ${rec.category}</h4>
                    <p class="text-gray-700">${rec.text}</p>
                </div>
            `).join('');

            document.getElementById('recommendationsSection').classList.remove('hidden');
        }
    </script>
</body>
</html>